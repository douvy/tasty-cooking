const sortDropdownButton=document.getElementById("dropdown-button"),sortDropdownMenu=document.getElementById("dropdown-menu"),sortDropdownText=sortDropdownButton.querySelector("span"),tagsDropdownButton=document.getElementById("tags-dropdown-button"),tagsDropdownMenu=document.getElementById("tags-dropdown-menu"),selectedTagsContainer=document.getElementById("selected-tags"),recipeGrid=document.getElementById("recipe-grid"),recipeCount=document.getElementById("recipe-count"),searchBar=document.getElementById("search-bar"),searchResults=document.getElementById("search-results");let defaultOrder=[],recipes=[],currentIndex=-1;function updateRecipeCount(){const e=document.querySelectorAll('#recipe-grid > a:not([style*="display: none"])').length;recipeCount.textContent=e}function addTagLabel(e){if(Array.from(selectedTagsContainer.children).some(t=>t.textContent.trim().startsWith(e)))return;const t=document.createElement("span");t.className="inline-flex items-center px-3 py-1 rounded-sm text-xs bg-gray capitalize text-light-green mr-2 cursor-pointer hover:bg-light-gray",t.innerHTML=`${e} <button type="button" class="ml-2 text-gray" aria-label="Remove tag"><i class="fas fa-times font-light"></i></button>`,selectedTagsContainer.appendChild(t),t.addEventListener("click",function(){t.remove(),removeActiveState(e),filterRecipes()}),t.addEventListener("mouseover",function(){t.querySelector("i").classList.add("text-white")}),t.addEventListener("mouseout",function(){t.querySelector("i").classList.remove("text-white")})}function removeTagLabel(e){Array.from(selectedTagsContainer.children).forEach(t=>{t.textContent.trim().startsWith(e)&&t.remove()})}function removeActiveState(e){document.querySelectorAll("[data-tag]").forEach(t=>{t.getAttribute("data-tag")===e&&t.classList.remove("bg-gray","text-white")})}function filterRecipes(){const e=Array.from(selectedTagsContainer.children).map(e=>e.textContent.trim().split(" ")[0]),t=document.querySelectorAll("#recipe-grid > a");t.forEach(t=>{const r=t.getAttribute("data-tags").split(" ");e.every(e=>r.includes(e))?t.style.display="":t.style.display="none"}),updateRecipeCount()}function updateHighlightedResult(e){e.forEach((e,t)=>{t===currentIndex?e.classList.add("bg-dark-gray"):e.classList.remove("bg-dark-gray")})}searchBar.setAttribute("autocomplete","off"),document.querySelectorAll("#recipe-grid .block").forEach(e=>{defaultOrder.push(e),recipes.push({title:e.querySelector(".recipe-title").innerText,element:e,link:e.getAttribute("href"),imgSrc:e.querySelector("img").src})}),tagsDropdownButton.addEventListener("click",function(e){e.stopPropagation(),tagsDropdownMenu.classList.toggle("hidden"),tagsDropdownButton.querySelector("svg").classList.toggle("transform"),tagsDropdownButton.querySelector("svg").classList.toggle("rotate-180"),sortDropdownMenu.classList.add("hidden"),sortDropdownButton.querySelector("svg").classList.remove("transform","rotate-180")}),sortDropdownButton.addEventListener("click",function(e){e.stopPropagation(),sortDropdownMenu.classList.toggle("hidden"),sortDropdownButton.querySelector("svg").classList.toggle("transform"),sortDropdownButton.querySelector("svg").classList.toggle("rotate-180"),tagsDropdownMenu.classList.add("hidden"),tagsDropdownButton.querySelector("svg").classList.remove("transform","rotate-180")}),document.querySelectorAll("[data-tag]").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();const t=e.target.getAttribute("data-tag");e.target.classList.contains("bg-gray")?(e.target.classList.remove("bg-gray","text-white"),removeTagLabel(t)):(e.target.classList.add("bg-gray","text-white"),addTagLabel(t)),filterRecipes()})}),document.querySelectorAll("[data-sort]").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();const t=e.target.getAttribute("data-sort");document.querySelectorAll("[data-sort]").forEach(e=>e.classList.remove("bg-gray","text-white")),e.target.classList.add("bg-gray","text-white");const r=Array.from(document.querySelectorAll("#recipe-grid > a")),a=document.getElementById("recipe-grid");"alphabetical"===t?r.sort((e,t)=>e.querySelector(".recipe-title").textContent.localeCompare(t.querySelector(".recipe-title").textContent)):r.sort((e,t)=>defaultOrder.indexOf(e)-defaultOrder.indexOf(t)),a.innerHTML="",r.forEach(e=>a.appendChild(e)),sortDropdownText.textContent=e.target.textContent.trim(),sortDropdownMenu.classList.add("hidden"),sortDropdownButton.querySelector("svg").classList.remove("transform","rotate-180")})}),window.addEventListener("click",e=>{sortDropdownButton.contains(e.target)||sortDropdownMenu.contains(e.target)||(sortDropdownMenu.classList.add("hidden"),sortDropdownButton.querySelector("svg").classList.remove("transform","rotate-180")),tagsDropdownButton.contains(e.target)||tagsDropdownMenu.contains(e.target)||(tagsDropdownMenu.classList.add("hidden"),tagsDropdownButton.querySelector("svg").classList.remove("transform","rotate-180"))}),sortDropdownMenu.addEventListener("click",e=>{e.stopPropagation()}),tagsDropdownMenu.addEventListener("click",e=>{e.stopPropagation()}),updateRecipeCount(),document.querySelectorAll("#recipe-grid img").forEach(e=>{e.setAttribute("loading","lazy"),e.setAttribute("sizes","(max-width: 640px) 50vw, (max-width: 1024px) 33vw, 25vw");const t=e.getAttribute("src");if(t&&!e.parentNode.tagName.toLowerCase()==="picture"){const r=t.split("/").pop().split(".")[0],s=`assets/img/webp/${r}.webp`,a=document.createElement("picture"),i=document.createElement("source");i.setAttribute("srcset",s),i.setAttribute("type","image/webp"),a.appendChild(i);const c=e.cloneNode(!0);c.setAttribute("srcset",`${t} 800w`),a.appendChild(c),e.parentNode.replaceChild(a,e)}}),searchBar.addEventListener("input",function(){const e=this.value.toLowerCase();if(searchResults.innerHTML="",currentIndex=-1,e){const t=recipes.filter(t=>t.title.toLowerCase().includes(e));t.length?(searchResults.classList.remove("hidden"),t.forEach(e=>{const t=document.createElement("div");t.className="px-4 py-2 cursor-pointer hover:bg-gray flex items-center space-x-2 border-b border-dark-gray-all",t.innerHTML=`<img src="${e.imgSrc}" alt="${e.title}" class="w-5 h-5 rounded-sm"> <span class="text-gray capitalize truncate">${e.title.toLowerCase()}</span>`,t.addEventListener("click",()=>{window.location.href=e.link}),searchResults.appendChild(t)})):searchResults.classList.add("hidden")}else searchResults.classList.add("hidden"),defaultOrder.forEach(e=>recipeGrid.appendChild(e)),updateRecipeCount()}),searchBar.addEventListener("keydown",function(e){const t=Array.from(searchResults.children);"ArrowDown"===e.key?currentIndex<t.length-1&&(currentIndex++,updateHighlightedResult(t)):"ArrowUp"===e.key?currentIndex>0&&(currentIndex--,updateHighlightedResult(t)):"Enter"===e.key?currentIndex>-1&&currentIndex<t.length&&t[currentIndex].click():"Escape"===e.key&&(searchResults.classList.add("hidden"),searchBar.classList.remove("bg-dark-gray"))}),searchBar.addEventListener("focus",function(){searchBar.classList.add("bg-gray")}),searchBar.addEventListener("blur",function(){searchBar.classList.remove("bg-dark-gray")}),window.addEventListener("click",e=>{searchBar.contains(e.target)||searchResults.contains(e.target)||(searchResults.classList.add("hidden"),searchBar.classList.remove("bg-dark-gray"))});