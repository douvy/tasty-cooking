document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("search-bar"),t=document.getElementById("search-results");if(!e||!t)return void console.error("Critical search elements not found on page");const r=new SearchService({debounceTime:300,fuzzyMatchThreshold:.3});let s=-1;e.setAttribute("role","combobox"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-autocomplete","list"),e.setAttribute("aria-controls","search-results"),e.setAttribute("aria-haspopup","listbox"),e.setAttribute("autocomplete","off"),t.setAttribute("role","listbox"),t.setAttribute("aria-label","Recipe search results"),r.on("recipesLoaded",function(){e.value.trim().length>0&&a()});const a=debounce(function(){const a=e.value.toLowerCase().trim();if(t.innerHTML="",s=-1,e.setAttribute("aria-expanded","true"),0===a.length)return void fetch("/").then(e=>e.text()).then(e=>{const t=new DOMParser,n=t.parseFromString(e,"text/html").querySelectorAll("#recipe-grid > a"),a=[];if(n.forEach(e=>{const t=e.querySelector(".recipe-title")?.textContent||"",n=e.getAttribute("href")||"";let r=e.querySelector("img");const s=r?r.getAttribute("src"):"";t&&n&&a.push({title:t,link:n,img:s})}),a.length>0)showResults(a);else{const e=r.getAllRecipes();e.length>0&&showResults(e)}}).catch(e=>{const t=r.getAllRecipes();t.length>0&&showResults(t)});if(!r.isLoaded())return void function(){t.classList.remove("hidden"),c();const e=document.createElement("div");e.className="px-4 py-3 text-off-white text-center",e.textContent="Loading recipes...",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),t.appendChild(e)}();const i=r.search(a,100);i.length>0?function(r){t.classList.remove("hidden"),c();const a=window.innerHeight-t.getBoundingClientRect().top-20;t.style.maxHeight=`${a}px`,t.style.overflowY="auto",document.body.style.overflow="hidden";const n=document.createElement("div");n.className="search-results-container w-full",r.forEach((t,r)=>{const a=document.createElement("div");a.className="px-4 py-2 cursor-pointer hover:bg-[#222616] flex items-center space-x-2 border-b border-[#2f3525] w-full",a.setAttribute("role","option"),a.setAttribute("id",`search-result-${r}`),a.setAttribute("aria-selected","false"),a.setAttribute("tabindex","-1"),a.innerHTML=`
                <img src="${t.img}" alt="" class="w-5 h-5 rounded-sm object-cover"> 
                <span class="text-off-white capitalize truncate">${t.title.toLowerCase()}</span>
            `,a.addEventListener("click",()=>{window.location.href=t.link}),n.appendChild(a)}),t.appendChild(n)}(i):function(){t.classList.remove("hidden"),c();const e=window.innerHeight-t.getBoundingClientRect().top-20;t.style.maxHeight=`${e}px`,t.style.overflowY="auto",document.body.style.overflow="hidden";const r=document.createElement("div");r.className="px-4 py-3 text-off-white text-center",r.textContent="No matching recipes found",r.setAttribute("role","status"),r.setAttribute("aria-live","polite"),t.appendChild(r)}()},300);function c(){t.style.width=window.innerWidth>=768?e.offsetWidth+"px":"100%"}function i(r){r.forEach((e,t)=>{t===s?(e.style.backgroundColor="#222616",e.setAttribute("aria-selected","true")):(e.style.backgroundColor="",e.setAttribute("aria-selected","false"))}),s>-1&&r[s]&&r[s].scrollIntoView({block:"nearest"})}e.addEventListener("input",a),e.addEventListener("keydown",function(r){const a=Array.from(t.querySelectorAll('[role="option"]'));if("ArrowDown"===r.key)r.preventDefault(),s<a.length-1&&(s++,i(a),e.setAttribute("aria-activedescendant",`search-result-${s}`));else if("ArrowUp"===r.key)r.preventDefault(),s>0&&(s--,i(a),e.setAttribute("aria-activedescendant",`search-result-${s}`));else if("Enter"===r.key)s>-1&&s<a.length&&a[s].click();else if("Escape"===r.key){t.classList.add("hidden"),e.setAttribute("aria-expanded","false"),document.body.style.overflow=""}}),document.addEventListener("click",function(r){e.contains(r.target)||t.contains(r.target)||(t.classList.add("hidden"),e.setAttribute("aria-expanded","false"),document.body.style.overflow="")}),window.addEventListener("resize",()=>{t&&!t.classList.contains("hidden")&&c()}),e.addEventListener("focus",function(){document.body.style.overflow="hidden",this.value.trim().length>0?a():fetch("/").then(e=>e.text()).then(e=>{const t=new DOMParser,n=t.parseFromString(e,"text/html").querySelectorAll("#recipe-grid > a"),a=[];if(n.forEach(e=>{const t=e.querySelector(".recipe-title")?.textContent||"",n=e.getAttribute("href")||"";let r=e.querySelector("img");const s=r?r.getAttribute("src"):"";t&&n&&a.push({title:t,link:n,img:s})}),a.length>0)showResults(a);else{const e=r.getAllRecipes();e.length>0&&showResults(e)}}).catch(e=>{const t=r.getAllRecipes();t.length>0&&showResults(t)})}),e.addEventListener("blur",function(e){t.contains(e.relatedTarget)||setTimeout(()=>{t.classList.contains("hidden")&&(document.body.style.overflow="")},100)})});