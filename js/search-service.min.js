/*** search-service.js* A best-in-class unified search implementation for Tasty Cooking website* Features:* - LocalStorage caching of recipe data with automatic refreshing* - Multiple data sources with intelligent fallbacks* - Smart search with term matching and synonyms* - Full ARIA accessibility and keyboard navigation* - Performance optimized with debouncing, caching, and minimal DOM operations* - Unified search experience across all pages*/(function() {'use strict';class SearchService {constructor(config = {}) {this.config = {cacheExpiration: 24 * 60 * 60 * 1000,cacheName: 'tasty-cooking-recipes',sitemapUrl: '/sitemap.xml',indexUrl: '/',searchLimit: 1000,debounceTime: 250,...config};this.recipes = [];this.recipesLoaded = false;this.dataLoadPromise = null;this.eventListeners = {};this.lastSearchQuery = '';this.init();}init() {const cachedRecipes = this.loadFromCache();if (cachedRecipes && cachedRecipes.length >= 40) {this.recipes = cachedRecipes;this.recipesLoaded = true;this.emitEvent('recipesLoaded', this.recipes);}this.loadRecipes().then(recipes => {if (recipes.length < 40) {console.warn(`Only loaded ${recipes.length} recipes, expected at least 40. Attempting to add fallback recipes.`);this.loadBasicRecipes().then(basicRecipes => {const recipeMap = new Map();this.recipes.forEach(recipe => {recipeMap.set(recipe.link, recipe);});basicRecipes.forEach(recipe => {if (!recipeMap.has(recipe.link)) {this.recipes.push(recipe);}});this.saveToCache(this.recipes);this.emitEvent('recipesLoaded', this.recipes);});}});}on(eventName, callback) {if (!this.eventListeners[eventName]) {this.eventListeners[eventName] = [];}this.eventListeners[eventName].push(callback);return this;}emitEvent(eventName, data) {if (this.eventListeners[eventName]) {this.eventListeners[eventName].forEach(callback => callback(data));}return this;}saveToCache(recipes) {try {const cacheData = {timestamp: Date.now(),recipes: recipes};localStorage.setItem(this.config.cacheName, JSON.stringify(cacheData));return true;} catch (error) {console.warn('Failed to save recipes to cache:', error);return false;}}loadFromCache() {try {const cachedData = localStorage.getItem(this.config.cacheName);if (!cachedData) return null;const { timestamp, recipes } = JSON.parse(cachedData);const now = Date.now();if (now - timestamp > this.config.cacheExpiration) {return null;}return recipes;} catch (error) {console.warn('Failed to load recipes from cache:', error);return null;}}loadRecipes() {if (this.dataLoadPromise) {return this.dataLoadPromise;}this.dataLoadPromise = Promise.all([this.fetchFromHTML().catch(e => []),this.fetchFromSitemap().catch(e => [])]).then(([htmlRecipes, sitemapRecipes]) => {let allRecipes = [...htmlRecipes];const existingLinks = new Map();allRecipes.forEach(recipe => {existingLinks.set(recipe.link, true);});sitemapRecipes.forEach(recipe => {if (!existingLinks.has(recipe.link)) {allRecipes.push(recipe);existingLinks.set(recipe.link, true);}});if (allRecipes.length < 40) {return this.loadBasicRecipes().then(basicRecipes => {basicRecipes.forEach(recipe => {if (!existingLinks.has(recipe.link)) {allRecipes.push(recipe);existingLinks.set(recipe.link, true);}});return allRecipes;});}return allRecipes;}).then(recipes => {this.recipes = recipes;this.recipesLoaded = true;this.saveToCache(recipes);this.emitEvent('recipesLoaded', recipes);this.dataLoadPromise = null;return recipes;}).catch(error => {return this.loadBasicRecipes().then(recipes => {this.recipes = recipes;this.recipesLoaded = true;this.saveToCache(recipes);this.emitEvent('recipesLoaded', recipes);this.dataLoadPromise = null;return recipes;});});return this.dataLoadPromise;}fetchFromSitemap() {return fetch(this.config.sitemapUrl).then(response => {if (!response.ok) {throw new Error(`Failed to fetch sitemap: ${response.status}`);}return response.text();}).then(xml => {const parser = new DOMParser();const sitemap = parser.parseFromString(xml, 'text/xml');const urls = sitemap.querySelectorAll('url loc');const recipes = [];urls.forEach(url => {const fullUrl = url.textContent;if (this.isNonRecipeUrl(fullUrl)) {return;}const urlParts = fullUrl.split('/');const slug = urlParts[urlParts.length - 1].replace('.html', '');if (slug) {const imgPath = this.getImagePathForSlug(slug);const title = this.slugToTitle(slug);const tags = this.getTagsFromSlug(slug);recipes.push({title: title,link: slug,img: imgPath,tags: tags,searchTerms: this.generateSearchTerms(title, slug, tags)});}});if (recipes.length === 0) {throw new Error('No recipes found in sitemap');}return recipes;});}isNonRecipeUrl(url) {const nonRecipePatterns = ['index.html','.css','.js','robots.txt','manifest.json','service-worker','sitemap.xml','CLAUDE.md','LICENSE','README.md'];for (const pattern of nonRecipePatterns) {if (url.includes(pattern)) {return true;}}if (url.endsWith('/')) {return true;}return false;}getTagsFromSlug(slug) {const tagMap = {'pancakes': ['breakfast'],'smoothie': ['breakfast', 'healthy'],'hash': ['breakfast'],'chicken': ['meat'],'wings': ['meat'],'salmon': ['seafood'],'beans': ['vegetarian'],'soup': ['healthy'],'salad': ['healthy', 'vegetable'],'tofu': ['vegetarian'],'vegan': ['vegan'],'kimchi': ['spicy'],'cauliflower': ['vegetable', 'healthy'],'broccolini': ['vegetable', 'healthy'],'brussels': ['vegetable'],'beets': ['vegetable'],'sweet-potato': ['vegetable']};let tags = [];Object.entries(tagMap).forEach(([key, value]) => {if (slug.includes(key)) {tags = [...tags, ...value];}});return [...new Set(tags)];}getImagePathForSlug(slug) {const specialCases = {'roasted-broccolini': 'assets/img/grilled-broccolini.jpg','honey-butter-pancakes': 'assets/img/pancakes.jpg','sesame-orange-chicken': 'assets/img/spicy-orange-sesame-chicken.jpg','nashville-hot-chicken': 'assets/img/nashville-chicken.jpg','pomodoro-sauce': 'assets/img/pomodoro.jpg','cajun-honey-butter-salmon': 'assets/img/cajun-salmon.jpg','california-za\'atar': 'assets/img/za\'atar.jpg','avocado-wraps': 'assets/img/black-bean-avocado-wraps.jpg','white-bean-wraps': 'assets/img/white-bean-wraps.jpg','falafels': 'assets/img/falafals.jpg'};return specialCases[slug] || `assets/img/${slug}.jpg`;}slugToTitle(slug) {return slug.split('-').map(word =>word.charAt(0).toUpperCase() + word.slice(1)).join(' ');}generateSearchTerms(title, slug, tags = []) {const terms = [title.toLowerCase(),slug.replace(/-/g, ' ')];title.toLowerCase().split(' ').forEach(word => {if (word.length > 2) {terms.push(word);}});slug.split('-').forEach(word => {if (word.length > 2) {terms.push(word);}});if (tags && tags.length) {terms.push(...tags);}const ingredientMap = {'tomato': ['pasta sauce', 'marinara', 'italian', 'sauce'],'chicken': ['poultry', 'meat', 'protein', 'wings'],'beans': ['legumes', 'protein', 'vegetarian', 'bean'],'broccolini': ['broccoli', 'vegetables', 'greens', 'vegetable'],'cauliflower': ['vegetables', 'cruciferous', 'vegetable'],'salad': ['healthy', 'fresh', 'raw', 'vegetable'],'kimchi': ['korean', 'spicy', 'fermented', 'cabbage'],'pancakes': ['breakfast', 'sweet', 'morning', 'pancake'],'salsa': ['mexican', 'sauce', 'dip', 'tomato'],'soup': ['stew', 'liquid', 'winter', 'warm'],'orange': ['citrus', 'fruit', 'juice'],'tofu': ['soy', 'vegetarian', 'protein', 'bean curd'],'honey': ['sweet', 'natural', 'syrup'],'potato': ['potatoes', 'starch', 'vegetable'],'butter': ['dairy', 'fat', 'creamy'],'garlic': ['allium', 'flavor', 'seasoning'],'lentil': ['legume', 'protein', 'vegetarian'],'sweet potato': ['yam', 'starchy', 'vegetable', 'orange']};Object.entries(ingredientMap).forEach(([key, alternatives]) => {if (slug.includes(key) || title.toLowerCase().includes(key)) {terms.push(...alternatives);}});if (slug.includes('pancake') || slug.includes('hash') || slug.includes('smoothie')) {terms.push('breakfast');} else if (slug.includes('soup') || slug.includes('stew')) {terms.push('lunch', 'dinner');} else if (slug.includes('sauce') || slug.includes('dip') || slug.includes('spread')) {terms.push('condiment', 'accompaniment');} else if (slug.includes('salad')) {terms.push('side', 'light');} else if (slug.includes('chicken') || slug.includes('salmon') || slug.includes('beef')) {terms.push('dinner', 'main course', 'entree');}terms.push('recipe', 'cooking', 'food', 'meal', 'dish', 'homemade');return [...new Set(terms)].filter(Boolean).join(' ');}fetchFromHTML() {return fetch(this.config.indexUrl).then(response => {if (!response.ok) {throw new Error(`Failed to fetch index: ${response.status}`);}return response.text();}).then(html => {const parser = new DOMParser();const doc = parser.parseFromString(html, 'text/html');const recipeCards = doc.querySelectorAll('#recipe-grid > a');const recipes = [];recipeCards.forEach(card => {const title = card.querySelector('.recipe-title')?.textContent || '';const link = card.getAttribute('href') || '';let img = card.querySelector('img');const imgSrc = img ? img.getAttribute('src') : '';const tags = card.getAttribute('data-tags')?.split(' ') || [];if (title && link) {const slug = link.replace('.html', '');recipes.push({title: title,link: slug,img: imgSrc,tags: tags,searchTerms: this.generateSearchTerms(title, slug, tags)});}});if (recipes.length === 0) {throw new Error('No recipes found in HTML');}return recipes;});}loadBasicRecipes() {return Promise.resolve([{ title: "Sesame Green Beans", link: "sesame-green-beans", img: "assets/img/sesame-green-beans.jpg", tags: ["gluten-free", "healthy", "quick", "vegan", "vegetable", "vegetarian"], searchTerms: "vegetables side dish" },{ title: "Guacamole", link: "guacamole", img: "assets/img/guacamole.jpg", tags: ["condiments", "gluten-free", "healthy", "quick", "vegan", "vegetarian"], searchTerms: "avocado dip mexican" },{ title: "Roasted Cauliflower", link: "roasted-cauliflower", img: "assets/img/roasted-cauliflower.jpg", tags: ["gluten-free", "healthy", "quick", "vegan", "vegetable", "vegetarian"], searchTerms: "vegetables side dish" },{ title: "Roasted Broccolini", link: "roasted-broccolini", img: "assets/img/grilled-broccolini.jpg", tags: ["meat", "vegetable", "spicy"], searchTerms: "vegetables side dish" },{ title: "Charred Brussels Sprouts", link: "charred-brussels-sprouts", img: "assets/img/charred-brussels-sprouts.jpg", tags: ["gluten-free", "healthy", "meat", "quick", "vegetable"], searchTerms: "vegetables side dish" },{ title: "Honey Butter Pancakes", link: "honey-butter-pancakes", img: "assets/img/pancakes.jpg", tags: ["breakfast"], searchTerms: "breakfast" },{ title: "Cajun Honey Butter Salmon", link: "cajun-honey-butter-salmon", img: "assets/img/cajun-salmon.jpg", tags: ["gluten-free", "quick", "seafood", "spicy"], searchTerms: "seafood" },{ title: "Roasted Chicken", link: "roasted-chicken", img: "assets/img/roasted-chicken.jpg", tags: ["gluten-free", "healthy", "meat"], searchTerms: "poultry meat" },{ title: "Black Bean Avocado Wraps", link: "avocado-wraps", img: "assets/img/black-bean-avocado-wraps.jpg", tags: ["healthy", "quick", "vegan", "vegetarian"], searchTerms: "vegetarian" },{ title: "Cucumber Salad", link: "cucumber-salad", img: "assets/img/cucumber-salad.jpg", tags: ["condiments", "gluten-free", "healthy", "vegan", "vegetable", "vegetarian"], searchTerms: "vegetable side" },{ title: "Sweet Potato Cakes", link: "sweet-potato-cakes", img: "assets/img/sweet-potato-cakes.jpg", tags: ["vegetable", "vegetarian", "spicy"], searchTerms: "vegetable" },{ title: "Leek Fritters", link: "leek-fritters", img: "assets/img/leek-fritters.jpg", tags: ["vegetable", "vegetarian", "spicy", "healthy"], searchTerms: "vegetable" },{ title: "Sweet Potato Hash", link: "sweet-potato-hash", img: "assets/img/sweet-potato-hash.jpg", tags: ["breakfast", "vegetable", "vegan", "vegetarian", "gluten-free", "healthy", "quick", "spicy"], searchTerms: "breakfast vegetable" },{ title: "Roasted Beets", link: "roasted-beets", img: "assets/img/roasted-beets.jpg", tags: ["vegetable", "vegan", "vegetarian", "gluten-free", "healthy"], searchTerms: "vegetable" },{ title: "Black Pepper Tofu", link: "black-pepper-tofu", img: "assets/img/black-pepper-tofu.jpg", tags: ["vegetarian", "spicy", "quick"], searchTerms: "vegetarian" },{ title: "Potato Green Bean Soup", link: "potato-green-bean-soup", img: "assets/img/potato-green-bean-soup.jpg", tags: ["vegetable", "vegetarian", "healthy"], searchTerms: "soup vegetable" },{ title: "Roasted Garlic Lentil Soup", link: "roasted-garlic-lentil-soup", img: "assets/img/roasted-garlic-lentil-soup.jpg", tags: ["healthy", "meat", "spicy"], searchTerms: "soup" },{ title: "Pistachio Butter", link: "pistachio-butter", img: "assets/img/pistachio-butter.jpg", tags: ["condiments", "gluten-free", "healthy", "quick", "vegan", "vegetarian"], searchTerms: "condiment" },{ title: "Beet Slaw", link: "beet-slaw", img: "assets/img/beet-slaw.jpg", tags: ["vegetable", "vegan", "vegetarian", "healthy"], searchTerms: "vegetable side" },{ title: "Ratatouille", link: "ratatouille", img: "assets/img/ratatouille.jpg", tags: ["vegetable", "vegan", "vegetarian", "gluten-free", "healthy"], searchTerms: "vegetable" },{ title: "Eggplant with Buttermilk Sauce", link: "eggplant-with-buttermilk-sauce", img: "assets/img/eggplant-with-buttermilk-sauce.jpg", tags: ["vegetable", "vegetarian", "gluten-free", "healthy"], searchTerms: "vegetable" },{ title: "Crunchy Pappardelle", link: "crunchy-pappardelle", img: "assets/img/crunchy-pappardelle.jpg", tags: ["vegetable", "vegetarian", "healthy"], searchTerms: "pasta" },{ title: "Chimichurri", link: "chimichurri", img: "assets/img/chimichurri.jpg", tags: ["condiments", "gluten-free", "vegan", "vegetarian"], searchTerms: "condiment sauce" },{ title: "Salsa", link: "salsa", img: "assets/img/salsa.jpg", tags: ["condiments", "gluten-free", "healthy", "quick", "spicy"], searchTerms: "condiment mexican" },{ title: "Nashville Hot Chicken", link: "nashville-hot-chicken", img: "assets/img/nashville-chicken.jpg", tags: ["meat", "spicy"], searchTerms: "meat chicken" },{ title: "Japanese Tebasaki Wings", link: "japanese-tebasaki-wings", img: "assets/img/japanese-wings.jpg", tags: ["gluten-free", "meat", "spicy"], searchTerms: "meat chicken" },{ title: "Grilled Buffalo Wings", link: "grilled-buffalo-wings", img: "assets/img/grilled-buffalo-wings.jpg", tags: ["gluten-free", "meat", "quick", "spicy"], searchTerms: "meat chicken" },{ title: "Pineapple Ginger Smoothie", link: "pineapple-ginger-smoothie", img: "assets/img/pineapple-ginger-smoothie.jpg", tags: ["gluten-free", "healthy", "quick", "vegan", "vegetarian"], searchTerms: "drink" },{ title: "Roasted Sweet Potato Salad", link: "roasted-sweet-potato-salad", img: "assets/img/roasted-sweet-potato-salad.jpg", tags: ["gluten-free", "healthy", "vegan", "vegetable", "vegetarian"], searchTerms: "vegetable" },{ title: "Falafels", link: "falafels", img: "assets/img/falafals.jpg", tags: ["gluten-free", "healthy", "vegan", "vegetarian"], searchTerms: "vegetarian" },{ title: "Spicy Kimchi Broccoli Rabe", link: "spicy-kimchi-broccoli-rabe", img: "assets/img/spicy-kimchi-broccoli-rabe.jpg", tags: ["gluten-free", "healthy", "quick", "spicy", "vegan", "vegetable", "vegetarian"], searchTerms: "vegetable spicy" },{ title: "California Za'atar", link: "california-za'atar", img: "assets/img/za'atar.jpg", tags: ["condiments", "gluten-free", "healthy", "quick", "vegan", "vegetarian"], searchTerms: "spice condiment" },{ title: "Soffrito", link: "soffrito", img: "assets/img/soffrito.jpg", tags: ["condiments", "gluten-free", "healthy", "quick", "vegan", "vegetarian"], searchTerms: "condiment" },{ title: "Mojo de Ajo", link: "mojo-de-ajo", img: "assets/img/mojo-de-ajo.jpg", tags: ["condiments", "gluten-free", "vegan", "vegetarian"], searchTerms: "condiment sauce" },{ title: "Romesco", link: "romesco", img: "assets/img/romesco.jpg", tags: ["condiments", "gluten-free", "vegan", "vegetarian"], searchTerms: "sauce condiment" },{ title: "Quesadillas", link: "quesadillas", img: "assets/img/quesadillas.jpg", tags: ["healthy", "quick", "vegan", "vegetarian"], searchTerms: "mexican" },{ title: "White Bean Wraps", link: "white-bean-wraps", img: "assets/img/white-bean-wraps.jpg", tags: ["healthy", "vegan", "vegetarian"], searchTerms: "vegetarian" },{ title: "Garlic Confit", link: "garlic-confit", img: "assets/img/garlic-confit.jpg", tags: ["condiments", "gluten-free", "healthy", "vegan", "vegetarian"], searchTerms: "condiment" },{ title: "Pineapple Kimchi", link: "pineapple-kimchi", img: "assets/img/pineapple-kimchi.jpg", tags: ["condiments", "gluten-free", "healthy", "spicy", "vegan", "vegetarian"], searchTerms: "condiment spicy" },{ title: "Pomodoro Sauce", link: "pomodoro-sauce", img: "assets/img/pomodoro.jpg", tags: ["condiments", "gluten-free", "healthy", "vegan", "vegetarian"], searchTerms: "sauce italian" },{ title: "Spaghetti Pomodoro", link: "spaghetti-pomodoro", img: "assets/img/spaghetti-pomodoro.jpg", tags: ["condiments", "gluten-free", "healthy", "vegan", "vegetarian"], searchTerms: "pasta italian" },{ title: "Tomato Confit", link: "tomato-confit", img: "assets/img/tomato-confit.jpg", tags: ["condiments"], searchTerms: "condiment" },{ title: "Sesame Orange Chicken", link: "sesame-orange-chicken", img: "assets/img/spicy-orange-sesame-chicken.jpg", tags: ["meat", "quick", "spicy"], searchTerms: "meat chicken" }]);}search(query) {if (!query || typeof query !== 'string') {return this.recipes;}const normalizedQuery = query.toLowerCase().trim();if (normalizedQuery.length === 0) {return this.recipes;}const exactMatches = this.recipes.filter(recipe =>recipe.title.toLowerCase().includes(normalizedQuery));const termMatches = this.recipes.filter(recipe =>!recipe.title.toLowerCase().includes(normalizedQuery) &&recipe.searchTerms &&recipe.searchTerms.includes(normalizedQuery));const titleWordMatches = this.recipes.filter(recipe =>!exactMatches.includes(recipe) &&!termMatches.includes(recipe) &&recipe.title.toLowerCase().split(' ').some(word =>word.includes(normalizedQuery) || normalizedQuery.includes(word)));const fallbackMatches = this.recipes.filter(recipe =>!exactMatches.includes(recipe) &&!termMatches.includes(recipe) &&!titleWordMatches.includes(recipe) &&(recipe.tags && recipe.tags.some(tag => tag.includes(normalizedQuery))));return [...exactMatches, ...termMatches, ...titleWordMatches, ...fallbackMatches];}isLoaded() {return this.recipesLoaded;}getAllRecipes() {return [...this.recipes];}refreshRecipes() {localStorage.removeItem(this.config.cacheName);this.recipesLoaded = false;this.dataLoadPromise = null;return this.loadRecipes();}filterByTags(tags) {if (!tags || !tags.length) {return this.getAllRecipes();}return this.recipes.filter(recipe =>tags.every(tag => recipe.tags && recipe.tags.includes(tag)));}sortRecipes(recipes, sortOption = 'default', defaultOrderIndices = null) {if (sortOption === 'alphabetical') {return [...recipes].sort((a, b) => a.title.localeCompare(b.title));}if (defaultOrderIndices && typeof defaultOrderIndices === 'object') {return [...recipes].sort((a, b) => {const indexA = defaultOrderIndices[a.link] || 9999;const indexB = defaultOrderIndices[b.link] || 9999;return indexA - indexB;});}return recipes;}}class SearchUI {constructor(options = {}) {this.options = {searchBarSelector: '#search-bar',searchResultsSelector: '#search-results',searchButtonSelector: '#mobile-search-button',searchContainerSelector: '#search',debounceTime: 250,maxResults: 1000,...options};this.searchBar = document.querySelector(this.options.searchBarSelector);this.searchResults = document.querySelector(this.options.searchResultsSelector);this.searchContainer = document.querySelector(this.options.searchContainerSelector);this.isMobile = window.innerWidth < 768;if (!this.searchBar || !this.searchResults) {return;}this.searchResultItems = [];this.currentIndex = -1;this.searchService = window.searchServiceInstance;this.searchModalOpen = false;this.initialize();}initialize() {this.debouncedSearch = debounce(this.performSearch.bind(this), this.options.debounceTime);if (this.isMobile) {this.setupMobileSearch();}this.setupEventListeners();if (document.activeElement === this.searchBar) {this.performSearch();}window.addEventListener('resize', debounce(() => {const wasMobile = this.isMobile;this.isMobile = window.innerWidth < 768;if (wasMobile !== this.isMobile) {this.closeSearchDropdown();if (this.searchModalOpen) {this.closeSearchModal();}if (this.isMobile && !document.querySelector('#mobile-search-button')) {this.setupMobileSearch();} else if (!this.isMobile) {if (this.originalSearchContent && this.searchContainer) {this.searchContainer.innerHTML = this.originalSearchContent;this.searchContainer.className = 'flex-1 md:flex-none md:ml-auto md:mr-4';this.searchBar = document.querySelector(this.options.searchBarSelector);this.searchResults = document.querySelector(this.options.searchResultsSelector);this.setupEventListeners();}}}}, 150));}setupMobileSearch() {const searchButton = document.createElement('button');searchButton.id = 'mobile-search-button';searchButton.className = 'w-[45px] h-[45px] bg-[#2e3523] rounded-sm flex items-center justify-center md:hidden';searchButton.setAttribute('aria-label', 'Search recipes');searchButton.innerHTML = '<i class="far fa-search text-[#f2ede4] fa-sm"></i>';if (this.searchContainer) {this.originalSearchContent = this.searchContainer.innerHTML;this.searchContainer.innerHTML = '';this.searchContainer.appendChild(searchButton);this.searchContainer.className = 'flex-none ml-auto';const mobileLogoSection = document.querySelector('.flex.items-center.md\\:hidden');if (mobileLogoSection) {const logoLink = mobileLogoSection.querySelector('a');if (logoLink && !logoLink.querySelector('span')) {const logoText = document.createElement('span');logoText.className = 'font-windsor-bold text-2xl text-off-white h-7 ml-2';logoText.textContent = 'tasty cooking';logoLink.appendChild(logoText);}}this.createSearchModal();searchButton.addEventListener('click', () => {this.openSearchModal();});}}createSearchModal() {if (!document.getElementById('search-modal')) {const modal = document.createElement('div');modal.id = 'search-modal';modal.className = 'fixed inset-0 bg-[#3f4427] z-50 flex flex-col transform translate-y-full transition-transform duration-300 ease-in-out';modal.style.height = '100%';const modalHeader = document.createElement('div');modalHeader.className = 'bg-[#3f4427] border-b border-[#2f3525] p-4 flex items-center';const backButton = document.createElement('button');backButton.className = 'text-off-white mr-4';backButton.innerHTML = '<i class="far fa-long-arrow-left text-xl"></i>';backButton.setAttribute('aria-label', 'Close search');const searchInputContainer = document.createElement('div');searchInputContainer.className = 'flex-1 relative';const searchIcon = document.createElement('span');searchIcon.className = 'absolute inset-y-0 left-0 flex items-center pl-3';searchIcon.innerHTML = '<i class="far fa-search text-[#f2ede4] fa-sm"></i>';const searchInput = document.createElement('input');searchInput.id = 'modal-search-input';searchInput.type = 'text';searchInput.placeholder = 'Search recipes';searchInput.className = 'w-full bg-[#2e3523] text-off-white placeholder:text-[#8B9168] rounded-sm py-2 pl-10 pr-4 focus:outline-none focus:ring-0 focus:border-none';searchInput.autocomplete = 'off';searchInputContainer.appendChild(searchIcon);searchInputContainer.appendChild(searchInput);modalHeader.appendChild(backButton);modalHeader.appendChild(searchInputContainer);const modalBody = document.createElement('div');modalBody.id = 'modal-search-results';modalBody.className = 'flex-1 overflow-y-auto bg-[#2A2F1E]';modal.appendChild(modalHeader);modal.appendChild(modalBody);document.body.appendChild(modal);backButton.addEventListener('click', () => {this.closeSearchModal();});searchInput.addEventListener('input', debounce(() => {this.performModalSearch(searchInput.value);}, this.options.debounceTime));searchInput.addEventListener('keydown', (event) => {if (event.key === 'Escape') {this.closeSearchModal();}});}}openSearchModal() {const modal = document.getElementById('search-modal');const modalInput = document.getElementById('modal-search-input');if (modal) {document.body.style.overflow = 'hidden';modal.style.transform = 'translateY(0)';this.searchModalOpen = true;setTimeout(() => {if (this.searchBar.value && modalInput) {modalInput.value = this.searchBar.value;this.performModalSearch(modalInput.value);} else {this.performModalSearch('');}}, 300);}}closeSearchModal() {const modal = document.getElementById('search-modal');if (modal) {modal.style.transform = 'translateY(100%)';document.body.style.overflow = '';this.searchModalOpen = false;if (!this.isMobile && this.originalSearchContent && this.searchContainer) {this.searchContainer.innerHTML = this.originalSearchContent;this.searchContainer.className = 'flex-1 md:flex-none md:ml-auto md:mr-4';this.searchBar = document.querySelector(this.options.searchBarSelector);this.searchResults = document.querySelector(this.options.searchResultsSelector);this.setupEventListeners();}}}performModalSearch(query) {const resultsContainer = document.getElementById('modal-search-results');if (!resultsContainer) return;resultsContainer.innerHTML = '';if (!this.searchService) {this.searchService = window.searchServiceInstance;if (!this.searchService) {resultsContainer.innerHTML = '<div class="px-4 py-3 text-off-white text-center">Search service unavailable</div>';return;}}if (!this.searchService.isLoaded()) {resultsContainer.innerHTML = '<div class="px-4 py-3 text-off-white text-center">Loading recipes...</div>';this.searchService.loadRecipes().then(() => {this.performModalSearch(query);});return;}let results = query? this.searchService.search(query.toLowerCase().trim()): this.searchService.getAllRecipes();if (results.length > 0) {results.forEach(recipe => {const item = document.createElement('div');item.className = 'px-4 py-2.5 cursor-pointer flex items-center space-x-3 border-b border-[#2f3525] hover:bg-[#232717]';const image = document.createElement('img');image.src = recipe.img;image.alt = '';image.className = 'w-10 h-10 rounded-sm object-cover';const title = document.createElement('span');title.className = 'text-off-white capitalize text-base';title.textContent = recipe.title.toLowerCase();item.appendChild(image);item.appendChild(title);item.addEventListener('click', () => {window.location.href = recipe.link;});resultsContainer.appendChild(item);});} else {const noResults = document.createElement('div');noResults.className = 'px-4 py-6 text-off-white text-center';noResults.textContent = 'No matching recipes found';resultsContainer.appendChild(noResults);}}setupEventListeners() {if (!this.isMobile) {this.searchBar.addEventListener('input', () => this.debouncedSearch());this.searchBar.addEventListener('focus', () => this.performSearch());document.addEventListener('click', event => {if (!this.searchBar.contains(event.target) && !this.searchResults.contains(event.target)) {this.closeSearchDropdown();}});this.searchBar.addEventListener('keydown', this.handleKeyNavigation.bind(this));}}handleKeyNavigation(event) {if (event.key === 'Escape') {this.closeSearchDropdown();} else if (event.key === 'ArrowDown') {event.preventDefault();this.navigateSearchResults(1);} else if (event.key === 'ArrowUp') {event.preventDefault();this.navigateSearchResults(-1);} else if (event.key === 'Enter' && this.currentIndex >= 0 && this.currentIndex < this.searchResultItems.length) {event.preventDefault();this.searchResultItems[this.currentIndex].click();}}navigateSearchResults(direction) {if (this.searchResultItems.length === 0) return;if (this.currentIndex >= 0 && this.currentIndex < this.searchResultItems.length) {this.searchResultItems[this.currentIndex].classList.remove('search-result-selected', 'bg-[#232717]');}if (direction > 0) {this.currentIndex = Math.min(this.currentIndex + 1, this.searchResultItems.length - 1);} else {this.currentIndex = Math.max(this.currentIndex - 1, 0);}if (this.currentIndex >= 0) {this.searchResultItems[this.currentIndex].classList.add('search-result-selected', 'bg-[#232717]');this.searchResultItems[this.currentIndex].scrollIntoView({ block: 'nearest' });}}closeSearchDropdown() {if (this.searchResults) {this.searchResults.classList.add('hidden');document.body.style.overflow = '';if (this.searchBar) {this.searchBar.value = '';}this.currentIndex = -1;this.searchResultItems = [];}}configureResultsDropdown() {this.searchResults.classList.remove('hidden');document.body.style.overflow = 'hidden';const topPosition = this.searchResults.getBoundingClientRect().top;const maxHeight = window.innerHeight - topPosition - 10;this.searchResults.style.maxHeight = `${maxHeight}px`;this.searchResults.style.overflowY = 'auto';if (window.innerWidth >= 768) {this.searchResults.style.width = this.searchBar.offsetWidth + 'px';} else {this.searchResults.style.width = '100%';}}performSearch() {if (!this.searchService) {this.searchService = window.searchServiceInstance;if (!this.searchService) return;}this.searchResults.innerHTML = '';this.searchResultItems = [];this.currentIndex = -1;this.configureResultsDropdown();const query = this.searchBar.value.toLowerCase().trim();if (!this.searchService.isLoaded()) {const loading = document.createElement('div');loading.className = 'px-4 py-3 text-off-white text-center';loading.textContent = 'Loading recipes...';this.searchResults.appendChild(loading);this.searchService.loadRecipes().then(() => {this.performSearch();});return;}if (this.searchService.getAllRecipes().length < 40) {this.searchService.refreshRecipes().then(() => {this.performSearch();});return;}let results = query? this.searchService.search(query): this.searchService.getAllRecipes();this.renderSearchResults(results);}renderSearchResults(results) {const container = document.createElement('div');if (results.length > 0) {const resultCount = Math.min(this.options.maxResults, results.length);results.slice(0, this.options.maxResults).forEach(recipe => {const item = document.createElement('div');item.className = 'px-4 py-2.5 cursor-pointer search-result-item flex items-center space-x-3 border-b border-[#2f3525] hover:bg-[#232717]';item.setAttribute('role', 'option');const image = document.createElement('img');image.src = recipe.img;image.alt = '';image.className = 'w-8 h-8 rounded-sm object-cover';const title = document.createElement('span');title.className = 'text-off-white capitalize truncate text-base';title.textContent = recipe.title.toLowerCase();item.appendChild(image);item.appendChild(title);item.addEventListener('click', () => {window.location.href = recipe.link;});this.searchResultItems.push(item);container.appendChild(item);});} else {const noResults = document.createElement('div');noResults.className = 'px-4 py-3 text-off-white text-center';noResults.textContent = 'No matching recipes found';container.appendChild(noResults);}this.searchResults.innerHTML = '';this.searchResults.appendChild(container);this.searchResults.setAttribute('role', 'listbox');this.searchResults.setAttribute('aria-label', 'Search results');}}window.SearchService = SearchService;window.searchServiceInstance = new SearchService();document.addEventListener('DOMContentLoaded', function() {if (window.searchServiceInstance && !window.searchServiceInstance.isLoaded()) {window.searchServiceInstance.loadRecipes();}new SearchUI();});})();/*** Debounce function for improving search input performance* Delays execution of a function until after a specified wait time*/function debounce(func, wait = 250) {let timeout;return function executedFunction(...args) {const later = () => {clearTimeout(timeout);func(...args);};clearTimeout(timeout);timeout = setTimeout(later, wait);};}